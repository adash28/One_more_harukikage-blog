{{- /* comments.html - è¯„è®ºç³»ç»Ÿé›†æˆ */ -}}

{{- if not (.Param "hideComments") }}
<div class="giscus">
    <h3 class="comments-title">ğŸ’¬ è¯„è®ºåŒº</h3>
    <p style="font-size: 0.9em; opacity: 0.7; margin-bottom: 1rem;">
        æ¬¢è¿ç•™ä¸‹æ‚¨çš„æƒ³æ³•å’Œå»ºè®®ï¼
    </p>
    
    {{- if site.Params.giscus }}
    <script src="https://giscus.app/client.js"
            data-repo="{{ site.Params.giscus.repo }}"
            data-repo-id="{{ site.Params.giscus.repoID }}"
            data-category="{{ site.Params.giscus.category }}"
            data-category-id="{{ site.Params.giscus.categoryID }}"
            data-mapping="{{ site.Params.giscus.mapping | default "pathname" }}"
            data-strict="{{ site.Params.giscus.strict | default "0" }}"
            data-reactions-enabled="{{ site.Params.giscus.reactionsEnabled | default "1" }}"
            data-emit-metadata="{{ site.Params.giscus.emitMetadata | default "0" }}"
            data-input-position="{{ site.Params.giscus.inputPosition | default "bottom" }}"
            data-theme="{{ site.Params.giscus.theme | default "preferred_color_scheme" }}"
            data-lang="{{ site.Params.giscus.lang | default "zh-CN" }}"
            data-loading="{{ site.Params.giscus.loading | default "lazy" }}"
            crossorigin="anonymous"
            async>
    </script>
    
    {{- /* ä¸»é¢˜åˆ‡æ¢é€‚é… */ -}}
    <script>
        // ç›‘å¬ä¸»é¢˜åˆ‡æ¢
        const themeToggle = document.getElementById('theme-toggle');
        if (themeToggle) {
            themeToggle.addEventListener('click', function() {
                setTimeout(function() {
                    const theme = document.documentElement.getAttribute('data-theme');
                    const giscusTheme = theme === 'dark' ? 'dark' : 'light';
                    const iframe = document.querySelector('iframe.giscus-frame');
                    if (iframe) {
                        iframe.contentWindow.postMessage({
                            giscus: {
                                setConfig: {
                                    theme: giscusTheme
                                }
                            }
                        }, 'https://giscus.app');
                    }
                }, 100);
            });
        }
    </script>
    {{- else }}
    <div style="padding: 2rem; text-align: center; background: var(--code-bg); border-radius: 8px;">
        <p style="margin-bottom: 1rem;">âš ï¸ è¯„è®ºç³»ç»Ÿå°šæœªé…ç½®</p>
        <p style="font-size: 0.9em; opacity: 0.7;">
            è¯·åœ¨ <code>hugo.toml</code> ä¸­é…ç½® giscus å‚æ•°ã€‚
            <a href="https://giscus.app/zh-CN" target="_blank" style="color: var(--primary);">è·å–é…ç½®</a>
        </p>
    </div>
    {{- end }}
</div>
{{- end }}
